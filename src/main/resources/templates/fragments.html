<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Thymeleaf fragments</title>
</head>
<body>

<!--Login-->
<div th:fragment="login">
    <h3 class="tab-title">Login page</h3><br>
    <!--/*@thymesVar id="loginError" type="java"*/-->
    <p th:if="${loginError}" class="alert">Wrong username or password</p>
    <form th:action="@{/login}" method="post">
        <label for="username">Username</label>:
        <input type="text" id="username" name="username" autofocus="autofocus"/> <br>
        <label for="password">Password</label>:
        <input type="password" id="password" name="password"/> <br>
        <br>
        <input type="submit" value="Log in"/>
    </form>
    <br>
    <button class="my-button" onclick="location.href = '/wl/register';" type="button">
        Register
    </button>
</div>

<!--Display on successful logout-->
<div th:fragment="logout-success">
    <h3 class="tab-title">Logout page</h3><br>
    <p class="alert">Logout successful!</p>
    <form th:action="@{/login}" method="get">
        <input type="submit" value="OK"/>
    </form>
</div>

<!--Display on unsuccessful logout-->
<div th:fragment="logout-failure">
    <h3 class="tab-title">Logout page</h3><br>
    <p class="alert">Logout error, please try again!</p>
    <form th:action="@{/user}" method="get">
        <input type="submit" value="OK"/>
    </form>
</div>

<!--User registration form-->
<div th:fragment="register-user">
    <h2>Please enter your details to register...</h2><br>
    <!--/*@thymesVar id="user" type="java"*/-->
    <form th:action="@{/register}" th:object="${user}" method="post">
        <input type="hidden" th:field="*{id}"/>
        <p>Username: <input type="text" th:field="*{name}" autofocus="autofocus"/>
            <span th:if="${#fields.hasErrors('name')}" class="alert" th:errors="*{name}"></span></p>
        <p>Password: <input type="password" th:field="*{password}"/>
            <span th:if="${#fields.hasErrors('password')}" class="alert"
                  th:errors="*{password}"></span>
            <!--/*@thymesVar id="passwordsDontMatch" type="java"*/-->
            <span class='alert' th:text="${passwordsDontMatch}"></span></p>
        <p>Confirm password: <input type="password" th:field="*{confirmPassword}"/>
            <span th:if="${#fields.hasErrors('confirmPassword')}" class="alert"
                  th:errors="*{confirmPassword}"></span></p>
        <p>Email: <input type="text" th:field="*{email}"/>
            <span th:if="${#fields.hasErrors('email')}" class="alert" th:errors="*{email}"></span>
            <!--/*@thymesVar id="emailExists" type="java"*/-->
            <span class='alert' th:text="${emailExists}"></span></p>
        <p><input type="checkbox" th:field="*{realEmail}" th:value="false"/>
            <span>This is a real email, please send me an activation message</span></p>
        <p>First name: <input type="text" th:field="*{firstName}"/></p>
        <p>Surname: <input type="text" th:field="*{lastName}"/></p>
        <p>Age: <input class="centered" type="number" th:field="*{age}"/></p>
        <p>Female: <input type="radio" th:field="*{gender}" th:value="false" th:checked="0"/>
            Male: <input type="radio" th:field="*{gender}" th:value="true" th:checked="0"/></p>
        <input type="hidden" th:field="*{role}"/>
        <input type="submit" value="Register new user">
        <button class="my-button" onclick="location.href='/wl/login';" type="button">Cancel</button>
    </form>
</div>

<!--User details edition form-->
<div th:fragment="update-user">
    <h2>Please edit your details...</h2><br>
    <!--/*@thymesVar id="user" type="java"*/-->
    <form th:action="@{/user/update}" th:object="${user}" method="post">
        <input type="hidden" th:field="*{id}"/>
        <p>Username: <input type="text" th:field="*{name}" autofocus="autofocus"/>
            <span th:if="${#fields.hasErrors('name')}" class="alert" th:errors="*{name}"></span></p>
        <p>Password: <input type="password" th:field="*{password}"/>
            <span th:if="${#fields.hasErrors('password')}" class="alert"
                  th:errors="*{password}"></span>
        <p>Email: <input type="text" th:field="*{email}"/>
            <span th:if="${#fields.hasErrors('email')}" class="alert" th:errors="*{email}"></span>
            <!--/*@thymesVar id="emailExists" type="java"*/-->
            <span class='alert' th:text="${emailExists}"></span></p>
        <p><input type="checkbox" th:field="*{realEmail}" th:value="false"/>
            <span>This is a real email, please send me a confirmation message</span></p>
        <p>First name: <input type="text" th:field="*{firstName}"/></p>
        <p>Surname: <input type="text" th:field="*{lastName}"/></p>
        <p>Age: <input class="centered" type="number" th:field="*{age}"/></p>
        <p>Female: <input type="radio" th:field="*{gender}" th:value="false" th:checked="0"/>
            Male: <input type="radio" th:field="*{gender}" th:value="true" th:checked="0"/></p>
        <input type="hidden" th:field="*{role}"/>
        <input type="submit" value="Update user details">
        <button class="my-button" onclick="location.href='/wl/login';" type="button">Cancel</button>
        <button class="my-button" onclick="location.href='/wl/user/changepassword';"
                type="button">Change password
        </button>
    </form>
</div>

<!--Change user's password form-->
<div th:fragment="change-password">
    <h2>Please enter and confirm both current and new passwords...</h2><br>
    <!--/*@thymesVar id="changePassword" type="java"*/-->
    <form th:action="@{/user/changepassword}" th:object="${changePassword}" method="post">
        <p>Current password: <input type="password" th:field="*{oldPassword}"
                                    autofocus="autofocus"/>
            <span th:if="${#fields.hasErrors('oldPassword')}" class="alert"
                  th:errors="*{oldPassword}"></span></p>
        <p>Confirm current password: <input type="password" th:field="*{confirmOldPassword}"/>
            <span th:if="${#fields.hasErrors('confirmOldPassword')}" class="alert"
                  th:errors="*{confirmOldPassword}"></span></p>
        <p>New password: <input type="password" th:field="*{newPassword}"/>
            <span th:if="${#fields.hasErrors('newPassword')}" class="alert"
                  th:errors="*{newPassword}"></span></p>
        <p>Confirm new password: <input type="password" th:field="*{confirmNewPassword}"/>
            <span th:if="${#fields.hasErrors('confirmNewPassword')}" class="alert"
                  th:errors="*{confirmNewPassword}"></span></p>
        <input type="submit" value="Change password">
        <button class="my-button" onclick="location.href='/wl/user/update';" type="button">Cancel
        </button>
    </form>
</div>

<!--User details registration successful-->
<div th:fragment="register-user-success">
    <h2>Registration successful!</h2><br>
    <button class="my-button" onclick="location.href='/wl/login';" type="button">OK</button>
</div>

<!--User details update successful-->
<div th:fragment="update-user-success">
    <h2>User details updated!</h2><br>
    <button class="my-button" onclick="location.href='/wl/user';" type="button">OK</button>
</div>

<!--Password change successful-->
<div th:fragment="change-password-success">
    <h2>New password has been set!</h2><br>
    <button class="my-button" onclick="window.location.pathname = 'wl/user/update';"
            type="button">OK
    </button>
</div>

<!--Admin panel-->
<div th:fragment="admin-panel" id="admin-panel">
    <div class="controls">
        <!--/*@thymesVar id="adminName" type="java"*/-->
        <p class="same-row" th:text="'Hello ' + ${adminName} + '!'"></p>
        <button class="same-row my-button" onclick="location.href='/wl/logout';"
                type="button">Log out
        </button>
        <button class="same-row my-button" onclick="location.href='/wl/user';"
                type="button">Back
        </button>
    </div>
    <h2>Welcome, Admin!</h2>
</div>

<!--User panel-->
<div th:fragment="user-panel" class="row no-gutters workout-tab-container" style="height: 95vh;">
    <div id="workout-content-container" class="col">
        <!--/*@thymesVar id="userPanelPage" type="java"*/-->
        <div th:if="${!userPanelPage.isEmpty()}" th:replace="__${userPanelPage}__">
            <p>If you see this message, something went wrong...</p>
        </div>
    </div>
    <div id="workout-selection-container" class="col">
        <div class="controls">
            <!--/*@thymesVar id="userName" type="java"*/-->
            <p class="same-row" th:text="'Hello ' + ${userName} + '!'"></p>
            <button class="same-row my-button" onclick="location.href='/wl/logout';"
                    type="button">Log out
            </button>
            <button class="same-row my-button" onclick="location.href='/wl/user/update';"
                    type="button">Account
            </button>
            <!--/*@thymesVar id="adminRights" type="java"*/-->
            <button th:if="${adminRights}" class="same-row my-button"
                    onclick="location.href='/wl/admin';">Admin panel
            </button>
        </div>
        <br>
        <table id="workouts-list">
            <!--/*@thymesVar id="workouts" type="java"*/-->
            <tr th:each="workout: ${workouts}">
                <td>
                    <button class="my-button" onclick="alert('Edit workout!');">
                        <th:block th:text="${workout.title}"/>
                        <br>
                        <th:block th:text="${workout.created}"/>
                    </button>
                </td>
            </tr>
        </table>

    </div>

    <!-- JS code for smooth column size adjustment -->
    <script>
        let splitobj = Split(["#workout-content-container", "#workout-selection-container"], {
            elementStyle: function (dimension, size, gutterSize) {
                $(window).trigger('resize'); // Optional
                return {'flex-basis': 'calc(' + size + '% - ' + gutterSize + 'px)'}
            },
            gutterStyle: function (dimension, gutterSize) {
                return {'flex-basis': gutterSize + 'px'}
            },
            sizes: [74, 24],
            minSize: 100,
            gutterSize: 6,
            cursor: 'col-resize'
        });
    </script>
</div>

<!-- user panel fragments - default -->
<div th:fragment="user-panel-default" class="workout-content">
    <br><br>
    <h2>Select existing workout from the panel to the right or...</h2>
    <button class="my-button" onclick="location.href='/wl/workout/add'" type="button">
        Add new workout
    </button>
</div>

<!-- user panel fragments - add new workout-->
<div th:fragment="user-panel-add-workout" class="workout-content">
    <br>
    <div class="same-row">
        <button class="my-button" onclick="saveWorkout(workout);" type="button">
            Save
        </button>
        <button class="my-button" onclick="location.href='/wl/user';" type="button">
            Cancel
        </button>
    </div>

    <br><br>
    <div>
        <label for="created">Created: </label>
        <input type="text" name="created" id="created" value=""
               onchange="workout['created'] = this.value;"/>
    </div>
    <br>
    <div>
        <label for="title">Title: </label><br>
        <div class="wrapper">
            <div class="left">
                <span contenteditable="true" class="my-input" id="title"></span>
            </div>
            <div class="right">
                <button class='my-button handwriting' title="Add workout note..."
                        onclick='addNote();'>&nbsp</button>
            </div>
        </div>
    </div>
    <br>
    <div id="notes"></div>
    <br>
    <div id="exercises"></div>
    <br>
    <button class="my-button" onclick="addExercise();">Add exercise</button>
    <br><br>

    <div class="same-row">
        <button class="my-button" onclick="saveWorkout(workout);" type="button">
            Save
        </button>
        <button class="my-button" onclick="location.href='/wl/user';" type="button">
            Cancel
        </button>
    </div>
    <script>document.getElementById('title').focus(); buildWorkout();</script>
</div>

<!-- user panel fragments - update existing workout-->
<div th:fragment="user-panel-update-workout" class="workout-content">
    <h2>Future update workout functionality!</h2>
    <button class="my-button" onclick="location.href='/wl/user';" type="button">
        Save workout</button>
</div>

</body>
</html>